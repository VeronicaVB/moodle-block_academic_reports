{"version":3,"sources":["../src/controls.js"],"names":["define","$","Ajax","Log","PubSub","Controls","debug","prototype","main","self","setupEvents","setPosition","subscribe","hasClass","css","length","hge","outerHeight","topge","position","extraspace","data","artop","top","value","toString","console","log","on","event","tdocumentsseq","target","tdss","displayReportService","call","methodname","args","done","response","base64Data","JSON","parse","blob","displayReport","fail","reason","error","fetch","base64Response","blobURL","URL","createObjectURL","window","open","init","control"],"mappings":"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","sourcesContent":["\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n\n/**\n * @package   block_academic_reports\n * @copyright 2021 Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n define(['jquery', 'core/ajax', 'core/log', 'core/pubsub'], function ($, Ajax, Log, PubSub) {\n    'use strict';\n\n    function init() {\n\n        var control = new Controls();\n        control.main();\n    }\n\n    /**\n    * Controls a single block_academic_reports block instance contents.\n    *\n    * @constructor\n    */\n    function Controls() {\n        Log.debug('block_academic_reports: initializing controls');\n        let self = this;\n\n    }\n\n    /**\n     * Run the controller.\n     *\n     */\n     Controls.prototype.main = function () {\n\n         let self = this;\n         self.setupEvents();\n         \n         self.setPosition();\n\n         // Subscribe to nav drawer event and resize when it completes.\n         PubSub.subscribe('nav-drawer-toggle-end', function (el) {\n             Log.debug('resizing block_academic_reports');\n             if ($(\"#nav-drawer\").hasClass(\"closed\")) {\n                $('table.table.table-striped.table-wrapper-scroll-y.my-custom-scrollbar').css('height', '140px');\n             } else {\n                $('table.table.table-striped.table-wrapper-scroll-y.my-custom-scrollbar').css('height', '185px');\n             }\n         });\n\n     };\n\n     Controls.prototype.setPosition = function () {\n\n         // Set top position based on the block grades effort which is on top of this block.\n         // $('.block_academic_reports').css({'top' : value});\n         if ($('.block_grades_effort_report').length == 0) {\n             return;\n         }\n\n         $('section.block.block_academic_reports.card.mb-3').css('top', () => { \n             const hge = $('.block_grades_effort_report').outerHeight(true);\n             const topge = $('.block_grades_effort_report').position();\n             let extraspace = 0;\n             if (!$('#performance').data('performance')) {\n                extraspace = 10;\n             }\n             let artop = hge + topge.top + extraspace;\n             const value = artop.toString() + 'px';\n             console.log('TOP: ' + value);\n             return value;\n         });\n\n         \n\n\n     }\n\n    Controls.prototype.setupEvents = function () {\n        let self = this;\n\n        $('.view-report').on('click', function (event) {\n            const tdocumentsseq = ($(event.target).data()).tdss;\n            self.displayReportService(tdocumentsseq);\n        });\n    };\n\n    Controls.prototype.displayReportService =  function (tdocumentsseq) {\n        let self = this;\n        Ajax.call([{\n            methodname: 'block_academic_reports_get_student_report',\n            args: {\n                tdocumentsseq: tdocumentsseq\n            },\n\n            done: function (response) {\n               const base64Data  = JSON.parse(response.blob);\n               self.displayReport(base64Data);\n            },\n\n            fail: function (reason) {\n                Log.error('block_academic_report_get_student_report: Unable to get blob.');\n                Log.debug(reason);\n            }\n        }]);\n\n        \n    };\n\n    Controls.prototype.displayReport = async function (base64Data) {\n        const base64Response = await fetch(`data:application/pdf;base64,${base64Data}`);\n        const blob = await base64Response.blob();\n        var blobURL = URL.createObjectURL(blob);\n        window.open(blobURL);\n    }\n\n\n\n    return { init: init }\n});\n"],"file":"controls.min.js"}